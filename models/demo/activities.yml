models:
  - name: activities
    meta:
      description: Activities performed on leads (calls, emails, meetings, etc.)
      primary_key: activity_id
      ai_hint: |
          This is an activities table containing sdr activities information and derived facts.
          Use this for sdr performance reporting, or sales pipeline efficiency analysis.

      parameters:
        type_channel_toggle:
          label: "Activity Type/Channel"
          description: "Filter activities by type or channel"
          options:
                - "activity_type"
                - "activity_channel"
          default: "activity_type"
          multiple: false

    metrics:
      avg_activities_per_lead:
        type: average
        description: "Average number of activities per lead"
        sql: SAFE_DIVIDE(${total_activities}, NULLIF(${lead_id_total_leads},0))
        groups: ['Activity Performance']
      demos_held:
        type: count
        description: "Total number of demo activities held"
        sql: CASE WHEN ${activity_type} = 'demo_held' THEN 1 ELSE NULL END
        groups: ['Activity Performance']

    columns:
      - name: activity_id
        description: "Unique identifier for the activity"
        tests:
          - not_null
          - unique
        meta:
          dimension:
            type: string
            label: Activity ID
          metrics:
            total_activities:
              type: count
              description: "Total number of activity records"
              groups: ['Activity Performance']
            activity_id_total_calls_made:
              label: Total Calls Made
              description: >-
                Count of Activity id on the table Activities with filters
                activities.activity_type
              type: count
              format: '#,##0.000'
              filters:
                - activity_type: call_made
              groups: ['Activity Performance']
            activity_id_total_demos_held:
              label: Total Demos Held
              description: >-
                Count of Activity id on the table Activities with filters
                activities.activity_type
              type: count
              filters:
                - activity_type: demo_held
              groups: ['Activity Performance']
            activity_id_total_contracts_sent:
              label: Total Contracts Sent
              description: >-
                Count of Activity id on the table Activities with filters
                activities.activity_type
              type: count
              filters:
                - activity_type: contract_sent
              groups: ['Activity Performance']
      - name: lead_id
        description: "The lead this activity is associated with"
        tests:
          - not_null
        meta:
          dimension:
            type: string
            label: Lead ID
          lead_id_total_leads:
            label: Total Leads
            description: 'Count distinct of Lead id on the table Activities '
            type: count_distinct
            format: '#,##0.000'
            filters: []
      - name: deal_id
        description: "The deal this activity is associated with"
        meta:
          dimension:
            type: string
            label: Deal ID
          lead_id_total_leads:
            label: Total Deals
            description: 'Count distinct of Lead id on the table Activities '
            type: count_distinct
            format: '#,##0.000'
      - name: sdr_name
        description: "Sales Development Rep who performed the activity"
        tests:
          - not_null
        meta:
          dimension:
            type: string
            label: SDR Name
      - name: activity_type
        description: "Type of activity (Call, Email, Meeting, etc.)"
        tests:
          - not_null
        meta:
          dimension:
            type: string
          additional_dimensions:
            type_channel_toggle:
              label: "Activity Type/Channel"
              type: string 
              description: Use this dimension to swap between activity type and activity channel
              sql: |
                case 
                  when ${lightdash.parameters.activities.type_channel_toggle} = 'activity_type' then ${activity_type}
                  when ${lightdash.parameters.activities.type_channel_toggle} = 'activity_channel' then ${activity_channel}
                end
            selected_dim: 
              label: Selected dimension
              type: string
              description: The dimension that is currently selected in the type_channel_toggle parameter
              sql: ${lightdash.parameters.activities.type_channel_toggle}
      - name: activity_channel
        description: "Channel used for the activity (phone, email, linkedin, etc.)"
        tests:
          - not_null
        meta:
          dimension:
            type: string
      - name: activity_timestamp
        description: "Timestamp when activity occurred"
        tests:
          - not_null
        meta:
          dimension:
            type: timestamp
            time_intervals: ['DAY', 'WEEK', 'MONTH', 'YEAR', 'QUARTER', 'MONTH_NAME', 'QUARTER_NAME']

      - name: notes
        description: "Free-text notes for the activity"
        meta:
          dimension:
            type: string
      - name: call_duration_seconds
        description: "Duration of call activities in seconds"
        meta:
          dimension:
            type: number
          metrics:
            total_call_time:
              type: sum
              description: "Total call time in seconds"
              groups: ['Call Metrics']
            avg_call_time:
              type: average
              label: Average call time
              description: "Average call time in seconds"
              groups: ['Call Metrics']
