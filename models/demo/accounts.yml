version: 2
models:
  - name: accounts
    meta:
      primary_key: account_id
      # This filter means that unless you are an admin, you can't see Enterprise account
      sql_filter: ${lightdash.attributes.is_admin_saas_demo} = 'true' or segment != 'Enterprise' 
      description: List of all customer and prospective customer Accounts pulled from our CRM 
      joins:
        - join: deals
          sql_on: ${accounts.account_id} = ${deals.account_id}
          type: left
          relationship: one-to-many
          fields: [deal_id, unique_deals, new_deals, won_deals, lost_deals, stage, average_amount, total_amount]
        - join: users
          relationship: one-to-many
          sql_on: ${accounts.account_id} = ${users.account_id}
          type: left
          fields: [user_id, unique_user_count, job_title, is_marketing_opted_in, unique_job_title_count, email, created_at, first_logged_in_at, experience_in_years, average_experience_in_years]
        - join: tracks
          relationship: one-to-many
          sql_on: ${users.user_id} = ${tracks.user_id}
          type: left
          fields: [id, user_id, event_count, name, timestamp, days_since_user_created]
    columns:
      - name: account_id
        description: "The Account ID from our database"
        meta:
          dimension:
            type: number
            urls:
              - label: 'Open in CRM'
                url: https://demo_saas.com/example/account/${ value.raw }
          metrics:
            unique_accounts:
              type: count_distinct
              description: The unique number of accounts based on distinct Account IDs
              spotlight:
                visibility: show
                categories:
                  - kpi
            unique_smb_accounts:
              label: Unique SMB Accounts
              type: count_distinct
              description: The unique number of accounts based on distinct Account IDs for accounts in the SMB Segment
              filters:
                - segment: 'SMB'
            unique_midmarket_accounts:
              label: Unique Midmarket Accounts
              type: count_distinct
              description: The unique number of Midmarket accounts based on distinct Account IDs for accounts in the Midmarket Segment
              filters:
                - segment: 'Midmarket'
            unique_enterprise_accounts:
              label: Unique Enterprise Accounts
              type: count_distinct
              description: The unique number of accounts based on distinct Account IDs for accounts in the Enterprise Segment
              filters:
                - segment: 'Enterprise'
      - name: account_name
        description: "Name of this company account"
        meta:
          dimension:
            type: string
      - name: industry
        description: "Stock market industry for this account"
        meta:
          dimension:
            type: string
      - name: segment
        description: "The market Segment for this account (SMB, Midmarket, Enterprise)"
        meta:
          dimension:
            type: string
      - name: estimated_annual_recurring_revenue
        description: "Estimated annual recurring revenue for this business"
        meta:
          dimension:
            type: number
          metrics:
            total_estimated_annual_recurring_revenue:
              type: sum
              label: "Total Estimated Annual Recurring Revenue"
              description: "Sum of all estimated annual recurring revenue"
              format: 'usd'