version: 2
models:
  - name: accounts
    meta:
      primary_key: account_id
      description: "This table contains the accounts in our demo SaaS application"
      # This filter means that unless you are an admin, you can't see Enterprise account
      sql_filter: ${lightdash.attributes.is_admin_saas_demo} = 'true' or segment != 'Enterprise' 
      joins:
        - join: deals
          relationship: one-to-many
          sql_on: ${accounts.account_id} = ${deals.account_id}
          type: left

    columns:
      - name: account_id
        description: "The Account ID from our database"
        meta:
          dimension:
            type: number
            urls:
              - label: 'Open in CRM'
                url: https://demo_saas.com/example/account/${ value.raw }
          metrics:
            
            unique_accounts:
              type: count_distinct
              description: The unique number of accounts based on distinct Account IDs
              spotlight:
                visibility: show
                categories:
                  - kpi
            account_count:
              type: count
              label: "Account Count"
              description: "‚ùå WRONG: Uses COUNT instead of COUNT_DISTINCT - will inflate based
                on the grain of the data"
            unique_smb_accounts:
              label: Unique SMB Accounts
              type: count_distinct
              description: The unique number of accounts based on distinct Account IDs for accounts in the SMB Segment
              filters:
                - segment: 'SMB'
            unique_midmarket_accounts:
              label: Unique Midmarket Accounts
              type: count_distinct
              description: The unique number of Midmarket accounts based on distinct Account IDs for accounts in the Midmarket Segment
              filters:
                - segment: 'Midmarket'
            unique_enterprise_accounts:
              label: Unique Enterprise Accounts
              type: count_distinct
              description: The unique number of accounts based on distinct Account IDs for accounts in the Enterprise Segment
              filters:
                - segment: 'Enterprise'

      - name: account_name
        description: "Name of this company account"
        meta:
          dimension:
            type: string
      - name: industry
        description: "Stock market industry for this account"
        meta:
          dimension:
            type: string
      - name: segment
        description: "The market Segment for this account (SMB, Midmarket, Enterprise)"
        meta:
          dimension:
            type: string
      - name: total_won_amount
        description: "The total amount of won deals for this account"
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            total_deal_amount:
              type: sum
              description: "The total revenue from all won deals in this account"
            
          